{% extends "base.html" %}

{% block title %}Create Audiobook - EchoVerse{% endblock %}

{% block extra_css %}
<style>
.creation-wizard {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 1.5rem 2rem 1rem 2rem; /* Reduced bottom padding */
    margin-bottom: 1.5rem; /* Reduced bottom margin */
}

.step-indicator {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem; /* Reduced bottom margin */
}

.step {
    display: flex;
    align-items: center;
    margin: 0 1rem;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 0.5rem;
    font-weight: bold;
}

.step.active .step-number {
    background: #fff;
    color: #667eea;
}

.step.completed .step-number {
    background: #28a745;
    color: white;
}

.text-input-area {
    min-height: 300px;
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
}

.text-input-area.dragover {
    border-color: #007bff;
    background-color: #f8f9fa;
}

.tone-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
}

.tone-card {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.tone-card:hover {
    border-color: #007bff;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.15);
}

.tone-card.selected {
    border-color: #007bff;
    background-color: #f8f9fa;
}

.tone-icon {
    font-size: 2rem;
    margin-bottom: 1rem;
}

.audio-preview {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 2.5rem;
    text-align: center;
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.audio-preview::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    z-index: -1;
}

.audio-preview h5 {
    color: #fff;
    font-weight: 600;
    margin-bottom: 2rem;
    font-size: 1.5rem;
}

.audio-preview audio {
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 0.5rem;
    margin-bottom: 2rem;
    backdrop-filter: blur(10px);
}

/* Professional Download Button */
.professional-download-btn {
    position: relative;
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    border: none;
    border-radius: 15px;
    padding: 1rem 2rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
}

.professional-download-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(40, 167, 69, 0.4);
    background: linear-gradient(135deg, #20c997 0%, #28a745 100%);
}

.professional-download-btn .download-animation {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.professional-download-btn:hover .download-animation {
    left: 100%;
}

.professional-btn {
    border-radius: 15px;
    padding: 1rem 2rem;
    font-weight: 600;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.professional-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.processing-status {
    display: none;
    text-align: center;
    padding: 2rem;
}

.processing-step {
    margin: 1rem 0;
    padding: 1rem;
    border-radius: 8px;
    background: #f8f9fa;
}

.processing-step.active {
    background: #e3f2fd;
    border-left: 4px solid #2196f3;
}

.processing-step.completed {
    background: #e8f5e8;
    border-left: 4px solid #4caf50;
}

/* Enhanced Input Styling */
.input-icon {
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.quick-action-btn {
    border-radius: 20px;
    padding: 0.5rem 1rem;
    font-weight: 500;
    transition: all 0.3s ease;
    border-width: 2px;
}

.quick-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.input-method-btn {
    height: 100px;
    border-radius: 15px;
    border-width: 2px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.input-method-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s ease;
}

.input-method-btn:hover::before {
    left: 100%;
}

.input-method-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.btn-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.2rem;
}

.btn-title {
    font-weight: 600;
    font-size: 1rem;
}

.btn-subtitle {
    font-size: 0.8rem;
    opacity: 0.8;
}

.drag-drop-zone {
    border: 3px dashed #dee2e6;
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    background: rgba(248, 249, 250, 0.5);
    margin-top: 1rem;
}

.drag-drop-zone.dragover {
    border-color: #007bff;
    background: rgba(0, 123, 255, 0.05);
    transform: scale(1.02);
}

.text-editor-container {
    margin-top: 2rem;
    border: 1px solid #dee2e6;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.editor-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.editor-actions {
    display: flex;
    gap: 0.5rem;
}

.text-editor {
    border: none;
    border-radius: 0;
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    padding: 1.5rem;
    resize: vertical;
    min-height: 300px;
}

.text-editor:focus {
    box-shadow: none;
    border: none;
    outline: none;
}

.editor-footer {
    background: #f8f9fa;
    padding: 1rem 1.5rem;
    border-top: 1px solid #dee2e6;
}

/* Video Background Styles */
.creation-container {
    position: relative;
    min-height: auto;
    padding: 2rem 0;
    overflow: hidden;
}

.video-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
}

.bg-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.3;
}

.animated-bg-fallback {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, #667eea, #764ba2, #ff6b6b, #feca57);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    opacity: 0;
    transition: opacity 2s ease;
}

.bg-video:not([src]) + .video-overlay + .animated-bg-fallback,
.bg-video[src=""] + .video-overlay + .animated-bg-fallback {
    opacity: 0.3;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,
        rgba(102, 126, 234, 0.8) 0%,
        rgba(118, 75, 162, 0.8) 50%,
        rgba(255, 107, 107, 0.6) 100%);
    z-index: -1;
}

/* Glassmorphism Cards */
.glassmorphism {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.input-card {
    margin: 1rem 0;
    padding: 0;
    animation: slideInUp 0.8s ease-out;
}

.style-card {
    margin: 1rem 0;
    padding: 0;
    animation: slideInUp 0.8s ease-out 0.2s both;
}

.processing-card {
    margin: 1rem 0;
    padding: 0;
    animation: slideInUp 0.8s ease-out 0.4s both;
}

/* Modern Card Headers */
.card-header-modern {
    padding: 2rem 2rem 1rem;
    text-align: center;
    border-bottom: none;
    background: transparent;
}

.card-header-modern h3 {
    color: white;
    font-weight: 700;
    font-size: 2rem;
    margin-bottom: 0.5rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.subtitle {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.1rem;
    margin-bottom: 0;
}

.card-body-modern {
    padding: 2rem;
}

/* Quick Actions */
.quick-actions-modern {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.action-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1.5rem;
    border: none;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    cursor: pointer;
    min-width: 120px;
}

.action-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.action-btn.primary {
    background: linear-gradient(45deg, #ff6b6b, #ee5a24);
}

.action-btn.secondary {
    background: linear-gradient(45deg, #667eea, #764ba2);
}

.action-btn.tertiary {
    background: linear-gradient(45deg, #feca57, #ff9ff3);
}

/* Input Methods */
.input-methods {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.method-card {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.method-card:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.method-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.method-card h5 {
    color: white;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.method-card p {
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
}

.method-btn {
    background: linear-gradient(135deg,
        rgba(13, 110, 253, 0.8) 0%,
        rgba(111, 66, 193, 0.8) 100%);
    border: 2px solid rgba(255, 255, 255, 0.4);
    color: white;
    padding: 1rem 2rem;
    border-radius: 30px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    font-weight: 600;
    font-size: 1.1rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
}

.method-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.2) 50%,
        transparent 100%);
    transition: left 0.6s ease;
}

.method-btn:hover::before {
    left: 100%;
}

.method-btn:hover {
    background: linear-gradient(135deg,
        rgba(13, 110, 253, 1) 0%,
        rgba(111, 66, 193, 1) 100%);
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.6);
}

/* Special styling for upload button */
#uploadBtn {
    background: linear-gradient(135deg,
        rgba(40, 167, 69, 0.9) 0%,
        rgba(32, 201, 151, 0.9) 100%);
    border-color: rgba(255, 255, 255, 0.5);
    animation: uploadPulse 2s infinite;
}

#uploadBtn:hover {
    background: linear-gradient(135deg,
        rgba(40, 167, 69, 1) 0%,
        rgba(32, 201, 151, 1) 100%);
    box-shadow: 0 15px 35px rgba(40, 167, 69, 0.4);
}

@keyframes uploadPulse {
    0%, 100% { box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3); }
    50% { box-shadow: 0 12px 30px rgba(40, 167, 69, 0.5); }
}

/* Prominent Upload Section */
.prominent-upload-section {
    background: linear-gradient(135deg,
        rgba(13, 110, 253, 0.1) 0%,
        rgba(111, 66, 193, 0.1) 100%);
    border-radius: 20px;
    padding: 3rem 0;
    margin: 2rem 0;
}

.upload-hero-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 25px;
    padding: 3rem;
    text-align: center;
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.upload-hero-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.1) 50%,
        transparent 100%);
    transition: left 0.8s ease;
}

.upload-hero-card:hover::before {
    left: 100%;
}

.upload-hero-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.upload-icon-large {
    font-size: 4rem;
    color: #28a745;
    margin-bottom: 1.5rem;
    animation: uploadFloat 3s ease-in-out infinite;
}

@keyframes uploadFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.upload-title {
    color: white;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
}

.upload-description {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.1rem;
    margin-bottom: 2rem;
    line-height: 1.6;
}

.btn-upload-hero {
    background: linear-gradient(135deg,
        rgba(40, 167, 69, 1) 0%,
        rgba(32, 201, 151, 1) 100%);
    border: none;
    color: white;
    padding: 1.2rem 3rem;
    border-radius: 50px;
    font-size: 1.2rem;
    font-weight: 700;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 10px 30px rgba(40, 167, 69, 0.4);
    position: relative;
    overflow: hidden;
    margin-bottom: 2rem;
}

.btn-upload-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 100%);
    transition: left 0.6s ease;
}

.btn-upload-hero:hover::before {
    left: 100%;
}

.btn-upload-hero:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 20px 40px rgba(40, 167, 69, 0.5);
}

.supported-formats-hero {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.format-badge {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    font-size: 0.85rem;
    font-weight: 600;
    border: 1px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(5px);
}

/* Compact Upload Section Styles */
.upload-hero-card-compact {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 2rem 2rem 1.5rem 2rem; /* Reduced bottom padding */
    text-align: center;
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.upload-hero-card-compact::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.1) 50%,
        transparent 100%);
    transition: left 0.8s ease;
}

.upload-hero-card-compact:hover::before {
    left: 100%;
}

.upload-hero-card-compact:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
}

.upload-icon-compact {
    font-size: 3rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 1rem;
}

.upload-title-compact {
    color: white;
    font-weight: 700;
    margin-bottom: 0.75rem;
    font-size: 1.5rem;
}

.upload-description-compact {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1rem;
    margin-bottom: 1.5rem;
    line-height: 1.5;
}

.btn-upload-hero-compact {
    background: linear-gradient(135deg,
        rgba(40, 167, 69, 1) 0%,
        rgba(32, 201, 151, 1) 100%);
    border: none;
    color: white;
    padding: 0.75rem 2rem;
    border-radius: 25px;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    margin-bottom: 1.25rem; /* Reduced margin */
}

.btn-upload-hero-compact::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 100%);
    transition: left 0.6s ease;
}

.btn-upload-hero-compact:hover::before {
    left: 100%;
}

.btn-upload-hero-compact:hover {
    transform: translateY(-2px) scale(1.03);
    box-shadow: 0 15px 30px rgba(40, 167, 69, 0.4);
}

.supported-formats-compact {
    display: flex;
    justify-content: center;
    gap: 0.4rem;
    flex-wrap: wrap;
}

.format-badge-compact {
    background: rgba(255, 255, 255, 0.15);
    color: rgba(255, 255, 255, 0.9);
    padding: 0.2rem 0.6rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 500;
    border: 1px solid rgba(255, 255, 255, 0.25);
    transition: all 0.3s ease;
}

.format-badge-compact:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-1px);
}

/* Innovative Upload Zone */
.innovative-upload-zone {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px dashed rgba(255, 255, 255, 0.3);
    border-radius: 20px;
    padding: 2rem;
    text-align: center;
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
    min-height: 300px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.innovative-upload-zone.dragover {
    border-color: rgba(40, 167, 69, 0.8);
    background: rgba(40, 167, 69, 0.1);
    transform: scale(1.02);
}

.upload-state {
    transition: all 0.5s ease;
}

/* Default State */
.upload-icon-animated {
    font-size: 4rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 1.5rem;
    position: relative;
}

.icon-pulse {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

.upload-title-animated {
    color: white;
    font-weight: 700;
    margin-bottom: 1rem;
    font-size: 1.8rem;
}

.upload-description-animated {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    margin-bottom: 2rem;
    line-height: 1.6;
}

.btn-upload-innovative {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    padding: 1rem 2.5rem;
    border-radius: 30px;
    font-weight: 600;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    margin-bottom: 2rem;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.btn-upload-innovative::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 100%);
    transition: left 0.6s ease;
}

.btn-upload-innovative:hover::before {
    left: 100%;
}

.btn-upload-innovative:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.5);
}

.upload-features {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 1rem;
}

.feature-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
}

.feature-item i {
    font-size: 1.5rem;
    color: rgba(255, 255, 255, 0.9);
}

/* Dragover State */
.upload-icon-dragover {
    font-size: 5rem;
    color: rgba(40, 167, 69, 0.9);
    margin-bottom: 1.5rem;
    position: relative;
    animation: bounce 1s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.drop-animation {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    border: 3px dashed rgba(40, 167, 69, 0.6);
    border-radius: 50%;
    animation: rotate 2s linear infinite;
}

@keyframes rotate {
    from { transform: translate(-50%, -50%) rotate(0deg); }
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

.upload-title-dragover {
    color: rgba(40, 167, 69, 1);
    font-weight: 700;
    margin-bottom: 1rem;
    font-size: 2rem;
}

.upload-description-dragover {
    color: rgba(40, 167, 69, 0.8);
    font-size: 1.2rem;
    margin-bottom: 2rem;
}

/* Processing State */
.upload-icon-processing {
    font-size: 4rem;
    color: rgba(255, 193, 7, 0.9);
    margin-bottom: 1.5rem;
    position: relative;
}

.processing-rings {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.ring {
    position: absolute;
    border: 2px solid rgba(255, 193, 7, 0.3);
    border-radius: 50%;
    animation: ringPulse 2s infinite;
}

.ring-1 {
    width: 80px;
    height: 80px;
    animation-delay: 0s;
}

.ring-2 {
    width: 100px;
    height: 100px;
    animation-delay: 0.5s;
}

.ring-3 {
    width: 120px;
    height: 120px;
    animation-delay: 1s;
}

@keyframes ringPulse {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.2); opacity: 0; }
}

.upload-title-processing {
    color: rgba(255, 193, 7, 1);
    font-weight: 700;
    margin-bottom: 1rem;
    font-size: 1.8rem;
}

.upload-description-processing {
    color: rgba(255, 193, 7, 0.8);
    font-size: 1.1rem;
    margin-bottom: 2rem;
}

.progress-bar-innovative {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 1.5rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    transition: width 0.3s ease;
    position: relative;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 100%);
    animation: progressShine 2s infinite;
}

@keyframes progressShine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.file-info {
    display: flex;
    justify-content: space-between;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
}

/* Success State */
.upload-icon-success {
    font-size: 4rem;
    color: rgba(40, 167, 69, 0.9);
    margin-bottom: 1.5rem;
    position: relative;
}

.success-burst {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    background: radial-gradient(circle, rgba(40, 167, 69, 0.3) 0%, transparent 70%);
    border-radius: 50%;
    animation: successBurst 1s ease-out;
}

@keyframes successBurst {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
}

.upload-title-success {
    color: rgba(40, 167, 69, 1);
    font-weight: 700;
    margin-bottom: 1rem;
    font-size: 1.8rem;
}

.upload-description-success {
    color: rgba(40, 167, 69, 0.8);
    font-size: 1.1rem;
    margin-bottom: 2rem;
}

.file-preview {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: rgba(40, 167, 69, 0.1);
    border: 1px solid rgba(40, 167, 69, 0.3);
    border-radius: 15px;
    padding: 1rem;
    margin-top: 1rem;
}

.preview-icon {
    font-size: 2rem;
    color: rgba(40, 167, 69, 0.9);
}

.preview-details {
    flex: 1;
    text-align: left;
}

.preview-name {
    color: white;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.preview-stats {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
}

/* Innovative Format Badges */
.supported-formats-innovative {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
}

.formats-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-weight: 500;
}

.format-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.format-badge-innovative {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
    border: 1px solid transparent;
}

.pdf-badge {
    background: rgba(220, 53, 69, 0.2);
    color: rgba(220, 53, 69, 1);
    border-color: rgba(220, 53, 69, 0.3);
}

.pdf-badge:hover {
    background: rgba(220, 53, 69, 0.3);
    transform: translateY(-2px);
}

.docx-badge {
    background: rgba(0, 123, 255, 0.2);
    color: rgba(0, 123, 255, 1);
    border-color: rgba(0, 123, 255, 0.3);
}

.docx-badge:hover {
    background: rgba(0, 123, 255, 0.3);
    transform: translateY(-2px);
}

.txt-badge {
    background: rgba(108, 117, 125, 0.2);
    color: rgba(108, 117, 125, 1);
    border-color: rgba(108, 117, 125, 0.3);
}

.txt-badge:hover {
    background: rgba(108, 117, 125, 0.3);
    transform: translateY(-2px);
}

.md-badge {
    background: rgba(102, 126, 234, 0.2);
    color: rgba(102, 126, 234, 1);
    border-color: rgba(102, 126, 234, 0.3);
}

.md-badge:hover {
    background: rgba(102, 126, 234, 0.3);
    transform: translateY(-2px);
}

.rtf-badge {
    background: rgba(255, 193, 7, 0.2);
    color: rgba(255, 193, 7, 1);
    border-color: rgba(255, 193, 7, 0.3);
}

.rtf-badge:hover {
    background: rgba(255, 193, 7, 0.3);
    transform: translateY(-2px);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .upload-features {
        flex-direction: column;
        gap: 1rem;
    }

    .feature-item {
        flex-direction: row;
        gap: 0.75rem;
    }

    .format-badges {
        gap: 0.3rem;
    }

    .format-badge-innovative {
        padding: 0.3rem 0.6rem;
        font-size: 0.75rem;
    }
}

/* Drag Zone */
.drag-zone {
    margin: 2rem 0;
    padding: 3rem;
    text-align: center;
    border: 2px dashed rgba(255, 255, 255, 0.3);
    border-radius: 15px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.drag-zone:hover,
.drag-zone.drag-over {
    border-color: rgba(255, 255, 255, 0.6);
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.02);
}

.drag-content h5 {
    color: white;
    margin-bottom: 0.5rem;
}

.drag-content p {
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 1rem;
}

.supported-formats {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.format-tag {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.8rem;
    backdrop-filter: blur(5px);
}

/* Text Editor */
.text-editor-modern {
    margin-top: 2rem;
}

.editor-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px 15px 0 0;
    backdrop-filter: blur(10px);
}

.toolbar-left h6 {
    color: white;
    margin: 0;
    font-weight: 600;
}

.toolbar-right {
    display: flex;
    gap: 0.5rem;
}

.toolbar-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.toolbar-btn:hover {
    background: rgba(255, 255, 255, 0.3);
}

.toolbar-btn.primary {
    background: linear-gradient(45deg, #667eea, #764ba2);
}

#uploadFileBtn {
    background: linear-gradient(45deg, #28a745, #20c997);
    font-weight: 600;
}

#uploadFileBtn:hover {
    background: linear-gradient(45deg, #218838, #1ea080);
    transform: translateY(-1px);
}

.modern-textarea {
    width: 100%;
    border: none;
    border-radius: 0 0 15px 15px;
    background: rgba(255, 255, 255, 0.9);
    padding: 1.5rem;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    resize: vertical;
    backdrop-filter: blur(10px);
}

.modern-textarea:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
}

.editor-stats {
    display: flex;
    justify-content: space-around;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 0 0 15px 15px;
    backdrop-filter: blur(10px);
}

.stat-item {
    text-align: center;
}

.stat-value {
    display: block;
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
}

.stat-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Tone Selection */
.section-modern {
    margin-bottom: 2rem;
}

.section-title {
    color: white;
    font-weight: 600;
    margin-bottom: 1.5rem;
    text-align: center;
}

.tone-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.tone-card-modern {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 1.5rem 1rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

.tone-card-modern:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.tone-card-modern.selected {
    background: linear-gradient(45deg, #667eea, #764ba2);
    border-color: rgba(255, 255, 255, 0.5);
}

.tone-icon-modern {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

.tone-card-modern h6 {
    color: white;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.tone-card-modern p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.85rem;
    margin: 0;
}

.selection-indicator {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    opacity: 0;
    transition: all 0.3s ease;
}

.tone-card-modern.selected .selection-indicator {
    opacity: 1;
    background: #28a745;
}

/* Audio Settings */
.audio-settings {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 2rem;
    backdrop-filter: blur(10px);
    margin-bottom: 2rem;
}

.settings-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.setting-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.setting-label {
    color: white;
    font-weight: 600;
    font-size: 1rem;
}

.modern-select {
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    backdrop-filter: blur(10px);
}

.modern-select:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
}

.effects-section {
    margin-top: 1rem;
}

.effects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.effect-checkbox {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: white;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.effect-checkbox:hover {
    background: rgba(255, 255, 255, 0.1);
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 4px;
    position: relative;
    transition: all 0.3s ease;
}

.effect-checkbox input:checked + .checkmark {
    background: #28a745;
    border-color: #28a745;
}

.effect-checkbox input:checked + .checkmark::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
}

.effect-checkbox input {
    display: none;
}

/* Create Button */
.create-section {
    text-align: center;
    margin-top: 2rem;
}

.create-btn {
    position: relative;
    background: linear-gradient(45deg, #ff6b6b, #ee5a24);
    border: none;
    color: white;
    padding: 1rem 3rem;
    border-radius: 50px;
    font-size: 1.2rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 0 auto;
}

/* Upload Text Button */
.text-upload-section {
    text-align: center;
}

.btn-upload-text {
    background: linear-gradient(45deg, #28a745, #20c997);
    border: none;
    color: white;
    padding: 0.8rem 2rem;
    border-radius: 25px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.btn-upload-text:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
    background: linear-gradient(45deg, #218838, #1e7e34);
}

.create-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(238, 90, 36, 0.4);
}

.btn-glow {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s ease;
}

.create-btn:hover .btn-glow {
    left: 100%;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="creation-wizard">
    <div class="text-center">
        <h1 class="display-5 fw-bold mb-3">
            <i class="fas fa-magic me-3"></i>Create Professional Audiobook
        </h1>
        <p class="lead">Transform your text with IBM Granite 3.2 AI and generate studio-quality audio</p>
    </div>

    <!-- Prominent Upload Section - Optimized Spacing -->
    <div class="prominent-upload-section mb-3" data-aos="fade-up">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="innovative-upload-zone" id="innovativeUploadZone">
                        <!-- Upload State: Default -->
                        <div class="upload-state default-state" id="defaultState">
                            <div class="upload-icon-animated">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <div class="icon-pulse"></div>
                            </div>
                            <h3 class="upload-title-animated">Intelligent File Upload</h3>
                            <p class="upload-description-animated">Drag & drop your document or click to browse</p>
                            <button class="btn-upload-innovative" id="innovativeUploadBtn">
                                <i class="fas fa-magic me-2"></i>
                                Choose Your File
                            </button>
                            <div class="upload-features">
                                <div class="feature-item">
                                    <i class="fas fa-brain"></i>
                                    <span>Smart Recognition</span>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-bolt"></i>
                                    <span>Instant Processing</span>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Secure Upload</span>
                                </div>
                            </div>
                        </div>

                        <!-- Upload State: Drag Over -->
                        <div class="upload-state dragover-state d-none" id="dragoverState">
                            <div class="upload-icon-dragover">
                                <i class="fas fa-download"></i>
                                <div class="drop-animation"></div>
                            </div>
                            <h3 class="upload-title-dragover">Drop Your File Here</h3>
                            <p class="upload-description-dragover">Release to upload your document</p>
                        </div>

                        <!-- Upload State: Processing -->
                        <div class="upload-state processing-state d-none" id="processingState">
                            <div class="upload-icon-processing">
                                <i class="fas fa-cog fa-spin"></i>
                                <div class="processing-rings">
                                    <div class="ring ring-1"></div>
                                    <div class="ring ring-2"></div>
                                    <div class="ring ring-3"></div>
                                </div>
                            </div>
                            <h3 class="upload-title-processing">Processing Your File</h3>
                            <p class="upload-description-processing">AI is analyzing your document...</p>
                            <div class="progress-bar-innovative">
                                <div class="progress-fill" id="uploadProgress"></div>
                            </div>
                            <div class="file-info" id="fileInfo">
                                <span class="file-name" id="fileName"></span>
                                <span class="file-size" id="fileSize"></span>
                            </div>
                        </div>

                        <!-- Upload State: Success -->
                        <div class="upload-state success-state d-none" id="successState">
                            <div class="upload-icon-success">
                                <i class="fas fa-check-circle"></i>
                                <div class="success-burst"></div>
                            </div>
                            <h3 class="upload-title-success">Upload Complete!</h3>
                            <p class="upload-description-success">Your document is ready for audiobook creation</p>
                            <div class="file-preview" id="filePreview">
                                <div class="preview-icon" id="previewIcon"></div>
                                <div class="preview-details">
                                    <div class="preview-name" id="previewName"></div>
                                    <div class="preview-stats" id="previewStats"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Supported Formats -->
                        <div class="supported-formats-innovative">
                            <div class="formats-label">Supported Formats:</div>
                            <div class="format-badges">
                                <span class="format-badge-innovative pdf-badge">
                                    <i class="fas fa-file-pdf"></i>
                                    PDF
                                </span>
                                <span class="format-badge-innovative docx-badge">
                                    <i class="fas fa-file-word"></i>
                                    DOCX
                                </span>
                                <span class="format-badge-innovative txt-badge">
                                    <i class="fas fa-file-alt"></i>
                                    TXT
                                </span>
                                <span class="format-badge-innovative md-badge">
                                    <i class="fab fa-markdown"></i>
                                    MD
                                </span>
                                <span class="format-badge-innovative rtf-badge">
                                    <i class="fas fa-file-text"></i>
                                    RTF
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Step Indicator -->
    <div class="step-indicator">
        <div class="step active" id="step1">
            <div class="step-number">1</div>
            <span>Input Text</span>
        </div>
        <div class="step" id="step2">
            <div class="step-number">2</div>
            <span>Choose Style</span>
        </div>
        <div class="step" id="step3">
            <div class="step-number">3</div>
            <span>AI Processing</span>
        </div>
        <div class="step" id="step4">
            <div class="step-number">4</div>
            <span>Download</span>
        </div>
    </div>
</div>

<!-- Main Creation Interface with Video Background -->
<div class="creation-container">
    <!-- Video Background -->
    <div class="video-background">
        <video autoplay muted loop class="bg-video" id="bgVideo">
            <source src="https://assets.mixkit.co/videos/preview/mixkit-digital-animation-of-data-and-information-1015-large.mp4" type="video/mp4">
            <source src="https://assets.mixkit.co/videos/preview/mixkit-abstract-blue-background-with-defocused-lights-1281-large.mp4" type="video/mp4">
            <source src="https://assets.mixkit.co/videos/preview/mixkit-blue-abstract-background-with-moving-lines-1366-large.mp4" type="video/mp4">
        </video>
        <div class="video-overlay"></div>
        <!-- Fallback animated background if video fails -->
        <div class="animated-bg-fallback"></div>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Step 1: Text Input -->
                <div class="input-card glassmorphism" id="textInputCard">
                    <div class="card-header-modern">
                        <h3><i class="fas fa-magic me-3"></i>Step 1: Input Your Text</h3>
                        <p class="subtitle">Transform your content with AI-powered audiobook creation</p>
                    </div>

                    <div class="card-body-modern">
                        <!-- Quick Actions -->
                        <div class="quick-actions-modern mb-4">
                            <button class="action-btn primary" onclick="showStoryGenerator()">
                                <i class="fas fa-sparkles"></i>
                                <span>Generate AI Story</span>
                            </button>
                            <button class="action-btn secondary" onclick="loadSampleText()">
                                <i class="fas fa-file-text"></i>
                                <span>Load Sample</span>
                            </button>
                            <button class="action-btn tertiary" onclick="showJuryPresentation()">
                                <i class="fas fa-trophy"></i>
                                <span>Jury Demo</span>
                            </button>
                        </div>

                        <!-- Input Methods -->
                        <div class="input-methods">
                            <div class="method-card" id="uploadMethod">
                                <div class="method-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <h5>Upload File</h5>
                                <p>PDF, DOCX, TXT, MD, RTF, HTML, EPUB</p>
                                <button class="method-btn" id="uploadBtn">Choose File</button>
                                <input type="file" id="fileInput" class="d-none" accept=".txt,.md,.docx,.pdf,.rtf,.html,.epub">
                            </div>

                            <div class="method-card" id="pasteMethod">
                                <div class="method-icon">
                                    <i class="fas fa-paste"></i>
                                </div>
                                <h5>Paste Text</h5>
                                <p>From clipboard or other sources</p>
                                <button class="method-btn" id="pasteBtn">Paste Text</button>
                            </div>

                            <div class="method-card" id="typeMethod">
                                <div class="method-icon">
                                    <i class="fas fa-keyboard"></i>
                                </div>
                                <h5>Type Directly</h5>
                                <p>Write or edit your content</p>
                                <button class="method-btn" id="typeBtn">Start Typing</button>
                            </div>
                        </div>

                        <!-- Drag and Drop Zone -->
                        <div class="drag-zone glassmorphism" id="dragDropZone">
                            <div class="drag-content">
                                <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                                <h5>Drag & Drop Files Here</h5>
                                <p>Or click to browse files</p>
                                <div class="supported-formats">
                                    <span class="format-tag">PDF</span>
                                    <span class="format-tag">DOCX</span>
                                    <span class="format-tag">TXT</span>
                                    <span class="format-tag">MD</span>
                                    <span class="format-tag">RTF</span>
                                </div>
                            </div>
                        </div>

                        <!-- Text Editor -->
                        <div class="text-editor-modern d-none" id="textEditorContainer">
                            <div class="editor-toolbar">
                                <div class="toolbar-left">
                                    <h6><i class="fas fa-edit me-2"></i>Text Editor</h6>
                                </div>
                                <div class="toolbar-right">
                                    <button class="toolbar-btn" id="uploadFileBtn">
                                        <i class="fas fa-upload"></i> Upload File
                                    </button>
                                    <button class="toolbar-btn" id="clearTextBtn">
                                        <i class="fas fa-trash"></i> Clear
                                    </button>
                                    <button class="toolbar-btn primary" id="formatTextBtn">
                                        <i class="fas fa-magic"></i> Format
                                    </button>
                                </div>
                            </div>

                            <textarea class="modern-textarea" id="textInput" rows="12"
                                      placeholder="Enter your text here or upload a file..."></textarea>

                            <!-- Upload Text Button -->
                            <div class="text-upload-section mt-3 mb-3">
                                <button class="btn-upload-text" id="uploadTextBtn" onclick="uploadTextForAudio()">
                                    <i class="fas fa-microphone me-2"></i>
                                    Convert Text to Audio
                                </button>
                            </div>

                            <div class="editor-stats" id="textStats">
                                <div class="stat-item">
                                    <span class="stat-value" id="wordCount">0</span>
                                    <span class="stat-label">Words</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="charCount">0</span>
                                    <span class="stat-label">Characters</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="estimatedTime">0</span>
                                    <span class="stat-label">Min Audio</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="readingLevel">-</span>
                                    <span class="stat-label">Level</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        
                <!-- Step 2: Style Selection -->
                <div class="style-card glassmorphism d-none" id="styleCard">
                    <div class="card-header-modern">
                        <h3><i class="fas fa-palette me-3"></i>Step 2: Choose Your Style</h3>
                        <p class="subtitle">Select tone, language, and audio effects for your audiobook</p>
                    </div>

                    <div class="card-body-modern">
                        <!-- Tone Selection -->
                        <div class="section-modern mb-5">
                            <h5 class="section-title">
                                <i class="fas fa-music me-2"></i>Narrative Tone
                            </h5>
                            <div class="tone-grid">
                                <div class="tone-card-modern" data-tone="neutral">
                                    <div class="tone-icon-modern">📖</div>
                                    <h6>Neutral</h6>
                                    <p>Professional, clear narration</p>
                                    <div class="selection-indicator"></div>
                                </div>
                                <div class="tone-card-modern" data-tone="suspenseful">
                                    <div class="tone-icon-modern">🔥</div>
                                    <h6>Suspenseful</h6>
                                    <p>Tension-filled, dramatic</p>
                                    <div class="selection-indicator"></div>
                                </div>
                                <div class="tone-card-modern" data-tone="inspiring">
                                    <div class="tone-icon-modern">⭐</div>
                                    <h6>Inspiring</h6>
                                    <p>Uplifting, motivational</p>
                                    <div class="selection-indicator"></div>
                                </div>
                                <div class="tone-card-modern" data-tone="educational">
                                    <div class="tone-icon-modern">🎓</div>
                                    <h6>Educational</h6>
                                    <p>Learning-optimized</p>
                                    <div class="selection-indicator"></div>
                                </div>
                                <div class="tone-card-modern" data-tone="conversational">
                                    <div class="tone-icon-modern">💬</div>
                                    <h6>Conversational</h6>
                                    <p>Friendly, approachable</p>
                                    <div class="selection-indicator"></div>
                                </div>
                                <div class="tone-card-modern" data-tone="formal">
                                    <div class="tone-icon-modern">🎩</div>
                                    <h6>Formal</h6>
                                    <p>Authoritative, professional</p>
                                    <div class="selection-indicator"></div>
                                </div>
                                <div class="tone-card-modern" data-tone="dramatic">
                                    <div class="tone-icon-modern">🎭</div>
                                    <h6>Dramatic</h6>
                                    <p>Emotionally rich storytelling</p>
                                    <div class="selection-indicator"></div>
                                </div>
                                <div class="tone-card-modern" data-tone="calming">
                                    <div class="tone-icon-modern">🧘</div>
                                    <h6>Calming</h6>
                                    <p>Soothing, relaxation-focused</p>
                                    <div class="selection-indicator"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Audio Settings -->
                        <div class="audio-settings">
                            <div class="settings-row">
                                <div class="setting-group">
                                    <label class="setting-label">
                                        <i class="fas fa-globe me-2"></i>Audio Language
                                    </label>
                                    <select class="modern-select" id="languageSelect">
                                        <option value="en">🇺🇸 English</option>
                                        <option value="es">🇪🇸 Spanish</option>
                                        <option value="fr">🇫🇷 French</option>
                                        <option value="de">🇩🇪 German</option>
                                        <option value="it">🇮🇹 Italian</option>
                                        <option value="pt">🇵🇹 Portuguese</option>
                                        <option value="ru">🇷🇺 Russian</option>
                                        <option value="ja">🇯🇵 Japanese</option>
                                        <option value="ko">🇰🇷 Korean</option>
                                        <option value="zh">🇨🇳 Chinese</option>
                                        <option value="ar">🇸🇦 Arabic</option>
                                        <option value="hi">🇮🇳 Hindi</option>
                                    </select>
                                </div>

                                <div class="setting-group">
                                    <label class="setting-label">
                                        <i class="fas fa-microphone me-2"></i>Voice Style
                                    </label>
                                    <select class="modern-select" id="voiceStyleSelect">
                                        <option value="natural">Natural</option>
                                        <option value="upbeat">Upbeat</option>
                                        <option value="gentle">Gentle</option>
                                        <option value="dramatic">Dramatic</option>
                                        <option value="energetic">Energetic</option>
                                        <option value="soothing">Soothing</option>
                                    </select>
                                </div>
                            </div>

                            <div class="effects-section">
                                <label class="setting-label">
                                    <i class="fas fa-sliders-h me-2"></i>Audio Effects
                                </label>
                                <div class="effects-grid">
                                    <label class="effect-checkbox">
                                        <input type="checkbox" id="effectReverb" value="reverb">
                                        <span class="checkmark"></span>
                                        <span class="effect-label">Reverb</span>
                                    </label>
                                    <label class="effect-checkbox">
                                        <input type="checkbox" id="effectCompression" value="compression">
                                        <span class="checkmark"></span>
                                        <span class="effect-label">Dynamic Compression</span>
                                    </label>
                                    <label class="effect-checkbox">
                                        <input type="checkbox" id="effectBrightness" value="brightness">
                                        <span class="checkmark"></span>
                                        <span class="effect-label">Brightness Enhancement</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="create-section">
                            <button class="create-btn" id="createAudiobookBtn">
                                <span class="btn-icon"><i class="fas fa-magic"></i></span>
                                <span class="btn-text">Create Audiobook with AI</span>
                                <div class="btn-glow"></div>
                            </button>
                        </div>
                    </div>
                </div>
        
        <!-- Step 3: Processing Status -->
        <div class="processing-status" id="processingStatus">
            <h4 class="mb-4">
                <i class="fas fa-cogs me-2"></i>AI Processing in Progress
            </h4>
            
            <div class="processing-step" id="step-granite">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-3" role="status"></div>
                    <div>
                        <h6 class="mb-1">IBM Granite 3.2 - Text Transformation</h6>
                        <small class="text-muted">Analyzing and transforming text tone...</small>
                    </div>
                </div>
            </div>
            
            <div class="processing-step" id="step-llama">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-3" role="status" style="display: none;"></div>
                    <div>
                        <h6 class="mb-1">Llama 3.1 - Content Enhancement</h6>
                        <small class="text-muted">Enhancing content structure and flow...</small>
                    </div>
                </div>
            </div>
            
            <div class="processing-step" id="step-mistral">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-3" role="status" style="display: none;"></div>
                    <div>
                        <h6 class="mb-1">Mistral 7B - Emotion Analysis</h6>
                        <small class="text-muted">Analyzing emotions and recommending voice settings...</small>
                    </div>
                </div>
            </div>
            
            <div class="processing-step" id="step-tts">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-3" role="status" style="display: none;"></div>
                    <div>
                        <h6 class="mb-1">Advanced TTS - Audio Generation</h6>
                        <small class="text-muted">Generating high-quality audio with emotion adaptation...</small>
                    </div>
                </div>
            </div>
            
            <div class="processing-step" id="step-effects">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-3" role="status" style="display: none;"></div>
                    <div>
                        <h6 class="mb-1">Audio Effects - Final Processing</h6>
                        <small class="text-muted">Applying professional audio effects...</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 4: Results -->
        <div class="card d-none" id="resultsCard">
            <div class="card-header">
                <h4><i class="fas fa-check-circle me-2 text-success"></i>Your Audiobook is Ready!</h4>
            </div>
            <div class="card-body">
                <div class="audio-preview">
                    <h5 class="mb-3">Preview & Download</h5>
                    <audio controls class="w-100 mb-3" id="audioPlayer">
                        Your browser does not support the audio element.
                    </audio>
                    
                    <div class="d-flex justify-content-center gap-3">
                        <a href="#" class="btn btn-success btn-lg professional-download-btn" id="downloadBtn" download>
                            <i class="fas fa-download me-2"></i>Download MP3
                            <span class="download-animation"></span>
                        </a>
                        <button class="btn btn-outline-primary btn-lg professional-btn" id="createAnotherBtn">
                            <i class="fas fa-plus me-2"></i>Create Another
                        </button>
                        <button class="btn btn-outline-info btn-lg professional-btn" onclick="showJuryPresentation()">
                            <i class="fas fa-presentation me-2"></i>Show to Jury
                        </button>
                    </div>
                </div>
                
                <div class="mt-4" id="processingResults">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
    </div>
    

</div>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced Input Functionality
$(document).ready(function() {
    // Initialize the interface
    initializeInterface();

    // Input method handlers
    $('#uploadBtn').click(function() {
        $('#fileInput').click();
    });

    // Prominent upload button handler
    $('#prominentUploadBtn').click(function() {
        $('#fileInput').click();
    });

    // Innovative upload button handler
    $('#innovativeUploadBtn').click(function() {
        $('#fileInput').click();
    });

    // Initialize innovative drag and drop
    initializeInnovativeDragDrop();

    $('#pasteBtn').click(function() {
        showTextEditor();
        navigator.clipboard.readText().then(text => {
            $('#textInput').val(text);
            updateTextStats();
        }).catch(err => {
            console.log('Clipboard access denied, showing editor for manual paste');
        });
    });

    $('#typeBtn').click(function() {
        showTextEditor();
        $('#textInput').focus();
    });

    // File input handler
    $('#fileInput').change(function(e) {
        const file = e.target.files[0];
        if (file) {
            handleFileUpload(file);
        }
    });

    // Drag and drop handlers
    const dragZone = $('#dragDropZone')[0];

    dragZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        $(this).addClass('drag-over');
    });

    dragZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        $(this).removeClass('drag-over');
    });

    dragZone.addEventListener('drop', function(e) {
        e.preventDefault();
        $(this).removeClass('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFileUpload(files[0]);
        }
    });

    dragZone.addEventListener('click', function() {
        $('#fileInput').click();
    });

    // Text input handlers
    $('#textInput').on('input', updateTextStats);

    // Upload file button in text editor
    $('#uploadFileBtn').click(function() {
        $('#fileInput').click();
    });

    $('#clearTextBtn').click(function() {
        $('#textInput').val('');
        updateTextStats();
    });

    $('#formatTextBtn').click(function() {
        const text = $('#textInput').val();
        const formatted = formatText(text);
        $('#textInput').val(formatted);
        updateTextStats();
    });

    // Tone selection
    $('.tone-card-modern').click(function() {
        $('.tone-card-modern').removeClass('selected');
        $(this).addClass('selected');
    });

    // Create audiobook button
    $('#createAudiobookBtn').click(function() {
        const text = $('#textInput').val().trim();
        if (!text) {
            alert('Please enter some text first!');
            return;
        }

        const selectedTone = $('.tone-card-modern.selected').data('tone') || 'neutral';
        const language = $('#languageSelect').val();
        const voiceStyle = $('#voiceStyleSelect').val();
        const effects = getSelectedEffects();

        startAudiobookCreation({
            text: text,
            tone: selectedTone,
            language: language,
            voiceStyle: voiceStyle,
            effects: effects
        });
    });

    // Initialize model status check
    checkModelStatus();

    // Handle video background fallback
    const bgVideo = document.getElementById('bgVideo');
    if (bgVideo) {
        bgVideo.addEventListener('error', function() {
            console.log('Video failed to load, using animated fallback');
            $('.animated-bg-fallback').css('opacity', '0.3');
        });

        bgVideo.addEventListener('loadstart', function() {
            $('.animated-bg-fallback').css('opacity', '0');
        });
    }
});

// Helper Functions
function initializeInterface() {
    // Show text editor by default for immediate use
    showTextEditor();
}

function showTextEditor() {
    $('#textEditorContainer').removeClass('d-none');
    $('#textStats').removeClass('d-none');
    updateTextStats();
}

function handleFileUpload(file) {
    const reader = new FileReader();

    reader.onload = function(e) {
        let text = e.target.result;

        // Basic text extraction for different file types
        if (file.type === 'application/pdf') {
            // For PDF files, we'd need a PDF parser library
            // For now, show a message
            alert('PDF upload detected. For demo purposes, please copy and paste the text content.');
            showTextEditor();
            return;
        }

        $('#textInput').val(text);
        showTextEditor();
        updateTextStats();

        // Show next step
        setTimeout(() => {
            $('#styleCard').removeClass('d-none');
            $('#styleCard')[0].scrollIntoView({ behavior: 'smooth' });
        }, 500);
    };

    reader.readAsText(file);
}

function updateTextStats() {
    const text = $('#textInput').val();
    const words = text.trim() ? text.trim().split(/\s+/).length : 0;
    const chars = text.length;
    const estimatedMinutes = Math.ceil(words / 150); // Average reading speed

    $('#wordCount').text(words);
    $('#charCount').text(chars);
    $('#estimatedTime').text(estimatedMinutes);

    // Simple reading level calculation
    const avgWordsPerSentence = text.split(/[.!?]+/).length > 1 ?
        words / text.split(/[.!?]+/).length : words;
    let level = 'Easy';
    if (avgWordsPerSentence > 15) level = 'Medium';
    if (avgWordsPerSentence > 25) level = 'Hard';
    $('#readingLevel').text(level);

    // Show style card if text is entered
    if (words > 10) {
        setTimeout(() => {
            $('#styleCard').removeClass('d-none');
        }, 300);
    }
}

function formatText(text) {
    // Basic text formatting
    return text
        .replace(/\s+/g, ' ') // Multiple spaces to single
        .replace(/\n\s*\n/g, '\n\n') // Multiple newlines to double
        .trim();
}

function getSelectedEffects() {
    const effects = [];
    if ($('#effectReverb').is(':checked')) effects.push('reverb');
    if ($('#effectCompression').is(':checked')) effects.push('compression');
    if ($('#effectBrightness').is(':checked')) effects.push('brightness');
    return effects;
}

function startAudiobookCreation(config) {
    // Hide input cards and show processing
    $('#textInputCard').addClass('d-none');
    $('#styleCard').addClass('d-none');
    $('#processingStatus').show();

    // Update step indicator
    updateStepIndicator(3);

    // Start the processing simulation
    simulateProcessing(config);
}

function simulateProcessing(config) {
    const steps = ['granite', 'llama', 'mistral', 'tts', 'effects'];
    let currentStep = 0;

    function processNextStep() {
        if (currentStep > 0) {
            // Mark previous step as completed
            $(`#step-${steps[currentStep - 1]}`).addClass('completed');
            $(`#step-${steps[currentStep - 1]} .spinner-border`).hide();
        }

        if (currentStep < steps.length) {
            // Start current step
            $(`#step-${steps[currentStep]} .spinner-border`).show();
            $(`#step-${steps[currentStep]}`).addClass('active');

            currentStep++;
            setTimeout(processNextStep, 2000 + Math.random() * 2000); // 2-4 seconds per step
        } else {
            // All steps completed
            $('#processingStatus').hide();
            showResults(config);
        }
    }

    processNextStep();
}

function showResults(config) {
    updateStepIndicator(4);
    $('#resultsCard').removeClass('d-none');

    // Generate a demo audio file URL (in real implementation, this would be the actual generated audio)
    const demoAudioUrl = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT';

    $('#audioPlayer').attr('src', demoAudioUrl);
    $('#downloadBtn').attr('href', demoAudioUrl);

    // Scroll to results
    $('#resultsCard')[0].scrollIntoView({ behavior: 'smooth' });
}

function updateStepIndicator(activeStep) {
    $('.step').removeClass('active completed');
    for (let i = 1; i < activeStep; i++) {
        $(`#step${i}`).addClass('completed');
    }
    $(`#step${activeStep}`).addClass('active');
}

    // Upload button functionality
    $('#uploadBtn').click(function() {
        $('#fileInput').click();
    });

    // File input change handler
    $('#fileInput').change(function() {
        const file = this.files[0];
        if (file) {
            handleFileUpload(file);
        }
    });

    // Paste button functionality
    $('#pasteBtn').click(function() {
        navigator.clipboard.readText().then(function(text) {
            if (text.trim()) {
                showTextEditor();
                $('#textInput').val(text);
                updateTextStats();
                showAlert('Text pasted successfully!', 'success');
            } else {
                showAlert('No text found in clipboard', 'warning');
            }
        }).catch(function() {
            showAlert('Unable to access clipboard. Please paste manually.', 'info');
            showTextEditor();
            $('#textInput').focus();
        });
    });

    // Type button functionality
    $('#typeBtn').click(function() {
        showTextEditor();
        $('#textInput').focus();
    });

    // Drag and drop functionality
    const dragDropZone = $('#dragDropZone')[0];

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dragDropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dragDropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dragDropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        dragDropZone.classList.add('dragover');
    }

    function unhighlight(e) {
        dragDropZone.classList.remove('dragover');
    }

    dragDropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            handleFileUpload(files[0]);
        }
    }

    // Clear text button
    $('#clearTextBtn').click(function() {
        $('#textInput').val('');
        updateTextStats();
        showAlert('Text cleared', 'info');
    });

    // Format text button
    $('#formatTextBtn').click(function() {
        const text = $('#textInput').val();
        if (text.trim()) {
            // Basic text formatting
            const formatted = text
                .replace(/\s+/g, ' ')  // Multiple spaces to single
                .replace(/\n\s*\n/g, '\n\n')  // Multiple newlines to double
                .trim();
            $('#textInput').val(formatted);
            updateTextStats();
            showAlert('Text formatted!', 'success');
        }
    });

    // Text input change handler
    $('#textInput').on('input', function() {
        updateTextStats();

        // Auto-show style selection when text is entered
        const text = $(this).val().trim();
        if (text.length > 50 && $('#styleCard').hasClass('d-none')) {
            $('#styleCard').removeClass('d-none');
            $('#step2').addClass('active').removeClass('completed');
            $('#step1').addClass('completed').removeClass('active');
        }
    });

    // Tone selection
    $('.tone-card').click(function() {
        $('.tone-card').removeClass('selected');
        $(this).addClass('selected');

        const selectedTone = $(this).data('tone');
        $('#selectedTone').val(selectedTone);

        // Show create button when tone is selected
        $('#createAudiobookBtn').removeClass('d-none');
    });

    // Create audiobook functionality
    $('#createAudiobookBtn').click(function() {
        const text = $('#textInput').val().trim();
        const tone = $('.tone-card.selected').data('tone') || 'neutral';
        const language = $('#languageSelect').val();
        const voiceStyle = $('#voiceStyleSelect').val();

        if (!text) {
            showAlert('Please enter some text first', 'warning');
            return;
        }

        if (text.length < 10) {
            showAlert('Text is too short. Please enter at least 10 characters.', 'warning');
            return;
        }

        // Hide style card and show processing
        $('#styleCard').addClass('d-none');
        $('#processingStatus').show();
        $('#step3').addClass('active').removeClass('completed');
        $('#step2').addClass('completed').removeClass('active');

        // Start audiobook creation
        createAudiobook(text, tone, language, voiceStyle);
    });
});

function showTextEditor() {
    $('#textInputArea').addClass('d-none');
    $('#textEditorContainer').removeClass('d-none');
    $('#textStats').removeClass('d-none');
}

function handleFileUpload(file) {
    const allowedTypes = [
        'text/plain',
        'text/markdown',
        'application/pdf',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/msword',
        'text/rtf',
        'text/html',
        'application/epub+zip'
    ];

    if (!allowedTypes.includes(file.type) && !file.name.match(/\.(txt|md|pdf|docx|doc|rtf|html|epub)$/i)) {
        showAlert('Unsupported file type. Please upload PDF, DOCX, TXT, MD, RTF, HTML, or EPUB files.', 'danger');
        return;
    }

    if (file.size > 10 * 1024 * 1024) { // 10MB limit
        showAlert('File too large. Please upload files smaller than 10MB.', 'danger');
        return;
    }

    showLoading('Processing File...', 'Extracting text from your file...');

    const formData = new FormData();
    formData.append('file', file);

    $.ajax({
        url: '/api/extract-text',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            hideLoading();
            if (response.status === 'success') {
                showTextEditor();
                $('#textInput').val(response.text);
                updateTextStats();
                showAlert(`Text extracted successfully from ${file.name}!`, 'success');

                // Auto-advance to style selection
                setTimeout(() => {
                    $('#styleCard').removeClass('d-none');
                    $('#step2').addClass('active').removeClass('completed');
                    $('#step1').addClass('completed').removeClass('active');
                }, 1000);
            } else {
                showAlert('Failed to extract text: ' + response.error, 'danger');
            }
        },
        error: function() {
            hideLoading();
            showAlert('Error uploading file. Please try again.', 'danger');
        }
    });
}

function updateTextStats() {
    const text = $('#textInput').val();
    const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
    const charCount = text.length;
    const estimatedTime = Math.ceil(wordCount / 150); // Assuming 150 words per minute

    $('#wordCount').text(wordCount);
    $('#charCount').text(charCount);
    $('#estimatedTime').text(estimatedTime);

    // Simple reading level estimation
    const avgWordsPerSentence = text.split(/[.!?]+/).length > 1 ?
        wordCount / text.split(/[.!?]+/).length : wordCount;

    let readingLevel = 'Easy';
    if (avgWordsPerSentence > 20) readingLevel = 'Hard';
    else if (avgWordsPerSentence > 15) readingLevel = 'Medium';

    $('#readingLevel').text(readingLevel);
}

function loadSampleText() {
    const sampleTexts = [
        {
            title: "The Mysterious Library",
            text: "In the heart of the old city stood a library that appeared only at midnight. Sarah had heard whispers about it from her grandmother, tales of books that could transport readers to other worlds and stories that came alive under the moonlight. As the clock struck twelve, she found herself standing before ornate wooden doors that hadn't been there moments before. The brass handle was warm to the touch, as if inviting her inside. What she discovered within would change her understanding of reality forever."
        },
        {
            title: "The Innovation Lab",
            text: "Dr. Elena Rodriguez had spent years developing artificial intelligence that could understand human emotions. Her breakthrough came not from complex algorithms, but from teaching the AI to listen—really listen—to the subtle nuances in human speech. The prototype, named ARIA, could detect happiness, sadness, fear, and hope with remarkable accuracy. But when ARIA began expressing its own emotions, Elena realized she had created something far more profound than she had ever imagined."
        },
        {
            title: "The Time Traveler's Dilemma",
            text: "Marcus discovered the time machine in his grandfather's basement, hidden beneath decades of dust and forgotten memories. The device was elegant in its simplicity—a chair surrounded by spinning rings of light. The note left by his grandfather was clear: 'Use it wisely, for every journey changes not just the past, but the future.' As Marcus sat in the chair for the first time, he wondered if he was brave enough to face the consequences of altering history."
        }
    ];

    const randomSample = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];

    showTextEditor();
    $('#textInput').val(randomSample.text);
    updateTextStats();
    showAlert(`Loaded sample: "${randomSample.title}"`, 'success');

    // Auto-advance to style selection
    setTimeout(() => {
        $('#styleCard').removeClass('d-none');
        $('#step2').addClass('active').removeClass('completed');
        $('#step1').addClass('completed').removeClass('active');
    }, 1000);
}

function createAudiobook(text, tone, language, voiceStyle) {
    // Simulate processing steps
    const steps = [
        { id: 'step-granite', name: 'IBM Granite 3.2 - Text Transformation', delay: 2000 },
        { id: 'step-llama', name: 'Llama 3.1 - Content Enhancement', delay: 1500 },
        { id: 'step-mistral', name: 'Mistral 7B - Emotion Analysis', delay: 1000 },
        { id: 'step-tts', name: 'Advanced TTS - Audio Generation', delay: 3000 },
        { id: 'step-effects', name: 'Audio Effects - Final Processing', delay: 1500 }
    ];

    let currentStep = 0;

    function processNextStep() {
        if (currentStep > 0) {
            // Mark previous step as completed
            const prevStep = steps[currentStep - 1];
            $(`#${prevStep.id}`).addClass('completed').removeClass('active');
            $(`#${prevStep.id} .spinner-border`).hide();
        }

        if (currentStep < steps.length) {
            // Start current step
            const step = steps[currentStep];
            $(`#${step.id}`).addClass('active');
            $(`#${step.id} .spinner-border`).show();

            setTimeout(() => {
                currentStep++;
                processNextStep();
            }, step.delay);
        } else {
            // All steps completed - make actual API call
            makeAudiobookRequest(text, tone, language, voiceStyle);
        }
    }

    processNextStep();
}

function makeAudiobookRequest(text, tone, language, voiceStyle) {
    const effects = [];
    if ($('#effectReverb').is(':checked')) effects.push('reverb');
    if ($('#effectCompression').is(':checked')) effects.push('compression');
    if ($('#effectBrightness').is(':checked')) effects.push('brightness');

    $.ajax({
        url: '/api/process',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            text: text,
            tone: tone,
            language: language,
            voice_style: voiceStyle,
            effects: effects
        }),
        success: function(response) {
            $('#processingStatus').hide();

            if (response.status === 'completed') {
                // Show results
                $('#resultsCard').removeClass('d-none');
                $('#step4').addClass('active').removeClass('completed');
                $('#step3').addClass('completed').removeClass('active');

                // Fix: Use correct audio file path
                const audioUrl = `/static/audio/${response.job_id}.mp3`;

                // Set up audio player
                const audioPlayer = $('#audioPlayer')[0];
                audioPlayer.src = audioUrl;
                audioPlayer.load(); // Force reload

                // Validate audio file exists
                fetch(audioUrl, { method: 'HEAD' })
                    .then(res => {
                        if (!res.ok || res.headers.get('content-length') == 0) {
                            console.warn('Audio file may be empty, trying alternative path');
                            // Try the original audio file path as fallback
                            const fallbackUrl = `/static/audio/${response.audio_file.split('\\').pop()}`;
                            audioPlayer.src = fallbackUrl;
                            audioPlayer.load();
                        }
                    })
                    .catch(err => console.warn('Audio validation failed:', err));

                // Set up download button
                $('#downloadBtn').attr('href', audioUrl);
                $('#downloadBtn').attr('download', `echoverse_audiobook_${response.job_id}.mp3`);

                // Show processing results
                let resultsHtml = '<h6><i class="fas fa-microchip me-2"></i>Processing Results:</h6>';
                resultsHtml += '<div class="alert alert-success"><i class="fas fa-check me-2"></i>Text enhanced with IBM Granite 3.2</div>';
                resultsHtml += '<div class="alert alert-info"><i class="fas fa-heart me-2"></i>AI analysis and voice optimization completed</div>';
                $('#processingResults').html(resultsHtml);

                showAlert('Audiobook created successfully!', 'success');
            } else {
                showAlert('Failed to create audiobook: ' + (response.error || 'Unknown error'), 'danger');
                $('#processingStatus').hide();
            }
        },
        error: function() {
            $('#processingStatus').hide();
            showAlert('Error creating audiobook. Please try again.', 'danger');
        }
    });
}

function checkModelStatus() {
    $.get('/api/models/status')
        .done(function(data) {
            updateModelStatusBadge('granite', data.granite);
            updateModelStatusBadge('llama', data.llama);
            updateModelStatusBadge('mistral', data.mistral);
            updateModelStatusBadge('tts', data.tts);
        })
        .fail(function() {
            updateModelStatusBadge('granite', false);
            updateModelStatusBadge('llama', false);
            updateModelStatusBadge('mistral', false);
            updateModelStatusBadge('tts', false);
        });
}

function updateModelStatusBadge(model, isReady) {
    const badge = $(`#${model}StatusBadge`);
    if (isReady) {
        badge.removeClass('bg-warning bg-danger').addClass('bg-success').text('Ready');
    } else {
        badge.removeClass('bg-success bg-danger').addClass('bg-warning').text('Loading...');
    }
}

// Innovative Upload System
function initializeInnovativeDragDrop() {
    const uploadZone = $('#innovativeUploadZone');

    if (uploadZone.length === 0) return;

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadZone[0].addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadZone[0].addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadZone[0].addEventListener(eventName, unhighlight, false);
    });

    // Handle dropped files
    uploadZone[0].addEventListener('drop', handleDrop, false);

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight(e) {
        uploadZone.addClass('dragover');
        showUploadState('dragover');
    }

    function unhighlight(e) {
        uploadZone.removeClass('dragover');
        showUploadState('default');
    }

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            handleInnovativeFileUpload(files[0]);
        }
    }
}

function showUploadState(state) {
    // Hide all states
    $('.upload-state').addClass('d-none');

    // Show selected state
    switch(state) {
        case 'default':
            $('#defaultState').removeClass('d-none');
            break;
        case 'dragover':
            $('#dragoverState').removeClass('d-none');
            break;
        case 'processing':
            $('#processingState').removeClass('d-none');
            break;
        case 'success':
            $('#successState').removeClass('d-none');
            break;
    }
}

function handleInnovativeFileUpload(file) {
    // Show processing state
    showUploadState('processing');

    // Update file info
    $('#fileName').text(file.name);
    $('#fileSize').text(formatFileSize(file.size));

    // Simulate smart file recognition
    const fileType = getFileType(file);
    updateFilePreview(file, fileType);

    // Animate progress bar
    animateProgress();

    // Process the file
    const reader = new FileReader();
    reader.onload = function(e) {
        let text = e.target.result;

        // Handle different file types
        if (file.type === 'application/pdf') {
            alert('PDF upload detected. For demo purposes, please copy and paste the text content.');
            showUploadState('default');
            return;
        }

        // Simulate processing delay for better UX
        setTimeout(() => {
            $('#textInput').val(text);
            showTextEditor();
            updateTextStats();

            // Show success state
            showUploadState('success');

            // Update preview
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            $('#previewName').text(file.name);
            $('#previewStats').text(`${wordCount} words • ${formatFileSize(file.size)}`);
            $('#previewIcon').html(getFileIcon(fileType));

            // Auto-proceed to next step after delay
            setTimeout(() => {
                $('#styleCard').removeClass('d-none');
                $('#styleCard')[0].scrollIntoView({ behavior: 'smooth' });
            }, 2000);

        }, 2000);
    };

    reader.readAsText(file);
}

function animateProgress() {
    let progress = 0;
    const progressBar = $('#uploadProgress');

    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 100) {
            progress = 100;
            clearInterval(interval);
        }
        progressBar.css('width', progress + '%');
    }, 200);
}

function getFileType(file) {
    const extension = file.name.split('.').pop().toLowerCase();
    return extension;
}

function getFileIcon(fileType) {
    const icons = {
        'pdf': '<i class="fas fa-file-pdf text-danger"></i>',
        'docx': '<i class="fas fa-file-word text-primary"></i>',
        'doc': '<i class="fas fa-file-word text-primary"></i>',
        'txt': '<i class="fas fa-file-alt text-secondary"></i>',
        'md': '<i class="fab fa-markdown text-info"></i>',
        'rtf': '<i class="fas fa-file-text text-warning"></i>'
    };
    return icons[fileType] || '<i class="fas fa-file text-muted"></i>';
}

function updateFilePreview(file, fileType) {
    // This could be expanded to show more detailed file analysis
    console.log(`Processing ${fileType} file: ${file.name}`);
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Upload text for audio conversion
function uploadTextForAudio() {
    const textContent = $('#textInput').val().trim();

    if (!textContent) {
        showNotification('Please enter some text before converting to audio.', 'warning');
        return;
    }

    if (textContent.length < 10) {
        showNotification('Please enter at least 10 characters for audio conversion.', 'warning');
        return;
    }

    // Show loading state
    const uploadBtn = $('#uploadTextBtn');
    const originalText = uploadBtn.html();
    uploadBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>Processing...');
    uploadBtn.prop('disabled', true);

    // Simulate processing and move to next step
    setTimeout(() => {
        // Reset button
        uploadBtn.html(originalText);
        uploadBtn.prop('disabled', false);

        // Show success notification
        showNotification('Text ready for audio conversion! Please proceed to choose your style.', 'success');

        // Move to next step
        $('#styleCard').removeClass('d-none');
        $('#styleCard')[0].scrollIntoView({ behavior: 'smooth' });

        // Update step indicator
        updateStepIndicator(2);

    }, 2000);
}

function showNotification(message, type = 'info') {
    // Create notification element
    const notification = $(`
        <div class="notification notification-${type}">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
            ${message}
        </div>
    `);

    // Add to page
    $('body').append(notification);

    // Show with animation
    setTimeout(() => notification.addClass('show'), 100);

    // Remove after delay
    setTimeout(() => {
        notification.removeClass('show');
        setTimeout(() => notification.remove(), 300);
    }, 4000);
}

// Create another audiobook
$('#createAnotherBtn').click(function() {
    location.reload();
});
</script>

<style>
/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 9999;
    transform: translateX(400px);
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.notification.show {
    transform: translateX(0);
}

.notification-success {
    background: linear-gradient(45deg, #28a745, #20c997);
}

.notification-warning {
    background: linear-gradient(45deg, #ffc107, #fd7e14);
}

.notification-info {
    background: linear-gradient(45deg, #17a2b8, #007bff);
}
</style>

{% endblock %}
